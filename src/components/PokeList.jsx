import React, { useContext, useEffect, useState } from "react";
import { UserContext } from "./constext";

const PokeList = (props) => {
    const { data } = props;
    const [isSearchString, setSearchString] = useState("")
    const [isResult, setResult] = useState(data || [])
    const [sortOrder, setSortOrder] = useState("default")
    const { selectedItem, setSelectedItem } = useContext(UserContext)

    useEffect(() => {
        setResult(data);
    }, [data]);

    useEffect(() => {
        if (isSearchString == "") {
            setResult(data)
        } else {
            const filtered = data.filter((d) => (d.name.toLowerCase().startsWith(isSearchString.toLowerCase())))
            setResult(filtered)
        }
    }, [isSearchString])

    const handleSort = () => {
        setSortOrder((prev) => (prev === "default" ? "asc" : prev === "asc" ? "desc" : "default"))
    }

    const handleInputChange = (e) => {
        setSearchString(e.target.value)
    }

    useEffect(() => {
        if (sortOrder === "asc") {
            // React state must be treated as immutable.Cannot call sort directly on the state array
            // [...] create a shallow copy of the array
            setResult([...isResult].sort((a, b) => a.name.localeCompare(b.name)))
        } else if (sortOrder === "desc") {
            setResult([...isResult].sort((a, b) => b.name.localeCompare(a.name)))
        } else {
        }
    }, [sortOrder])

    const handleClick = (item) => {
        setSelectedItem(item);
    }

    return (
        <div>
            <div className="flex gap-4 w-96">
                <input className="bg-linear-[#E1D6BB,#DED1AF] shadow-lg rounded-4xl h-12 w-64 py-2 px-5 font-bold" onChange={handleInputChange} type="text" />
                <button
                    className={`h-12 rounded-2xl shadow-md text-[#493022] transform hover:scale-110 shadow-[#94623F] flex grow justify-center items-center ${sortOrder === 'default' ? 'bg-[#CA8446]' : 'bg-red-500'} py-1 px-4 font-bold hover:cursor-pointer`}
                    onClick={handleSort}
                >
                    {sortOrder === "default" && "Sort By"}
                    {sortOrder === "asc" && "Sort A-Z"}
                    {sortOrder === "desc" && "Sort Z-A"}
                </button>
            </div>
            <ul>
                {isResult != []
                    ?
                    <div className="bg-[#E1D6BB]/70 mt-5 w-96 h-[580px] rounded-[20px] overflow-y-scroll">
                        <div className="flex flex-col w-fit gap-3 pl-5 pt-5">
                            {isResult.map((d, i) => (
                                <div className="flex flex-row whitespace-nowrap gap-3 items-center">
                                    {selectedItem?.name === d.name ?
                                        <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1898" width="32" height="32"><path d="M512 511.991895m-499.841753 0a499.841753 499.841753 0 1 0 999.683506 0 499.841753 499.841753 0 1 0-999.683506 0Z" fill="#FF1A1A" p-id="1899"></path><path d="M12.158247 511.991895a499.841753 382.838887 0 1 0 999.683506 0 499.841753 382.838887 0 1 0-999.683506 0Z" fill="#D60909" p-id="1900"></path><path d="M12.158247 511.991895c0 276.081372 223.784698 499.849858 499.849858 499.849858 276.04895 0 499.833647-223.768487 499.833648-499.849858H12.158247z" fill="#FFFFFF" p-id="1901"></path><path d="M512.008105 894.830782c276.04895 0 499.833647-171.415074 499.833648-382.838887H12.158247c0 211.423813 223.784698 382.838887 499.849858 382.838887z" fill="#D8E5EA" p-id="1902"></path><path d="M12.158247 511.991895a499.841753 135.896782 0 1 0 999.683506 0 499.841753 135.896782 0 1 0-999.683506 0Z" fill="#80949B" p-id="1903"></path><path d="M177.072712 511.991895a334.927288 91.057166 0 1 0 669.854576 0 334.927288 91.057166 0 1 0-669.854576 0Z" fill="#63797F" p-id="1904"></path><path d="M12.158247 511.991895c0-75.056913 223.784698-135.896782 499.849858-135.896782 276.04895 0 499.833647 60.839869 499.833648 135.896782" fill="#3E5054" p-id="1905"></path><path d="M512.008105 0C229.6855 0 0 229.677395 0 511.991895c0 282.322605 229.6855 512.008105 512.008105 512.008105 282.3145 0 511.991895-229.6855 511.991895-512.008105C1024 229.677395 794.322605 0 512.008105 0z m484.773632 524.150142c-25.175677 55.036332-217.162506 111.580287-484.773632 111.580287-267.619232 0-459.614166-56.543955-484.789842-111.580287h969.563474z m-969.563474-24.316495C52.39394 444.797315 244.388874 388.25336 512.008105 388.25336c267.611126 0 459.597955 56.543955 484.773632 111.580287H27.218263zM512.008105 24.316494c251.991831 0 459.946491 192.116517 485.114063 437.575317-73.184543-63.944275-284.227397-97.954945-485.114063-97.954945-200.894771 0-411.945731 34.002565-485.130273 97.946839C52.045403 216.433011 260.008169 24.316494 512.008105 24.316494z m0 975.367012c-251.999937 0-459.962702-192.124622-485.130273-437.591528 73.184543 63.944275 284.235503 97.946839 485.130273 97.94684 200.886666 0 411.92952-34.002565 485.114063-97.94684-25.167572 245.466905-233.122232 437.591527-485.114063 437.591528z" fill="#33363A" p-id="1906"></path></svg>
                                        :
                                        <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1590" width="32" height="32"><path d="M512 511.991895m-499.841753 0a499.841753 499.841753 0 1 0 999.683506 0 499.841753 499.841753 0 1 0-999.683506 0Z" fill="#FF1A1A" p-id="1591"></path><path d="M12.158247 511.991895a499.841753 382.838887 0 1 0 999.683506 0 499.841753 382.838887 0 1 0-999.683506 0Z" fill="#D60909" p-id="1592"></path><path d="M12.158247 511.991895c0 276.081372 223.784698 499.849858 499.841753 499.849858s499.841753-223.768487 499.841753-499.849858H12.158247z" fill="#FFFFFF" p-id="1593"></path><path d="M512 894.830782c276.057055 0 499.841753-171.415074 499.841753-382.838887H12.158247c0 211.423813 223.784698 382.838887 499.841753 382.838887z" fill="#D8E5EA" p-id="1594"></path><path d="M512 0C229.677395 0 0 229.677395 0 511.991895c0 282.322605 229.677395 512.008105 512 512.008105s512-229.6855 512-512.008105C1024 229.677395 794.322605 0 512 0z m0 24.316494c264.83094 0 480.882993 212.226257 487.375497 475.517153H24.624503C31.117007 236.542752 247.16906 24.316494 512 24.316494z m0 975.367012c-264.83094 0-480.882993-212.234363-487.375497-475.533364h974.750994c-6.492504 263.299001-222.544556 475.533364-487.375497 475.533364z" fill="#33363A" p-id="1595"></path><path d="M512 558.209445m-135.880571 0a135.880571 135.880571 0 1 0 271.761142 0 135.880571 135.880571 0 1 0-271.761142 0Z" fill="#A7BBC1" p-id="1596"></path><path d="M512 512m-135.880571 0a135.880571 135.880571 0 1 0 271.761142 0 135.880571 135.880571 0 1 0-271.761142 0Z" fill="#FFFFFF" p-id="1597"></path><path d="M415.917425 608.082575c-53.066696-53.066696-53.058591-139.090348 0-192.173255 53.066696-53.058591 139.098453-53.058591 192.157044 0" fill="#D8E5EA" p-id="1598"></path><path d="M512 660.046923c-39.53862 0-76.71854-15.400446-104.682508-43.364415-57.711147-57.711147-57.711147-151.629553 0-209.365016 57.727358-57.711147 151.637659-57.711147 209.356911 0a147.114791 147.114791 0 0 1 43.37252 104.690613c0 39.53862-15.400446 76.71854-43.37252 104.682509a147.058052 147.058052 0 0 1-104.674403 43.356309z m0-271.712508a123.317048 123.317048 0 0 0-87.482641 36.174838c-48.227714 48.25203-48.227714 126.745674 0 174.981494a122.911774 122.911774 0 0 0 87.482641 36.239682 122.879352 122.879352 0 0 0 87.474536-36.239682 122.919879 122.919879 0 0 0 36.247787-87.482642c0-33.046116-12.871531-64.11449-36.247787-87.490746a123.284626 123.284626 0 0 0-87.474536-36.182944z" fill="#33363A" p-id="1599"></path><path d="M558.233761 558.225656c-25.524214 25.499897-66.927098 25.499897-92.4351 0a65.362737 65.362737 0 1 1 92.4351 0z" fill="#FFFFFF" p-id="1600"></path><path d="M465.798661 465.798661A65.354631 65.354631 0 0 1 558.233761 558.225656" fill="#D8E5EA" p-id="1601"></path><path d="M512.008105 589.472351a77.277819 77.277819 0 0 1-54.809378-22.646762c-30.225403-30.233508-30.225403-79.409565 0-109.626862a76.953599 76.953599 0 0 1 54.801273-22.711606c20.709548 0 40.178954 8.073076 54.817484 22.711606 30.217297 30.209192 30.217297 79.385249 0.008105 109.618757l-0.008105 0.008105a77.285925 77.285925 0 0 1-54.809379 22.646762z m-0.008105-130.668735a52.815426 52.815426 0 0 0-37.609511 15.586873 53.253123 53.253123 0 0 0 0 75.235233c20.733864 20.725759 54.493264 20.725759 75.243339 0a53.277439 53.277439 0 0 0-0.008106-75.235233 52.912692 52.912692 0 0 0-37.625722-15.586873z" fill="#33363A" p-id="1602"></path></svg>
                                    }
                                    <li
                                        key={i}
                                        onClick={() => handleClick(d)}
                                        className={`${selectedItem?.name === d.name ? 'text-red-500' : 'text-black'} text-l hover:text-xl hover:cursor-pointer`}
                                    >
                                        {d.name.toUpperCase()}
                                    </li>
                                </div>
                            ))}
                        </div>
                    </div>
                    :
                    <div>No result</div>
                }
            </ul>
        </div>
    );
};

export default PokeList;